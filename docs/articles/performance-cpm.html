<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Simulation-based evaluation of {bayesDCA} for Clinical Prediction Models (CPMs).
">
<!-- Inform modern browsers that this page supports both dark and light color schemes,
  and the page author prefers light. --><meta name="color-scheme" content="dark light">
<script>
  // If `prefers-color-scheme` is not supported, fall back to light mode.
  // i.e. In this case, inject the `light` CSS before the others, with
  // no media filter so that it will be downloaded with highest priority.
  if (window.matchMedia("(prefers-color-scheme: dark)").media === "not all") {
    document.documentElement.style.display = "none";
    document.head.insertAdjacentHTML(
      "beforeend",
      "<link id=\"css\" rel=\"stylesheet\" href=\"https://bootswatch.com/5/flatly/bootstrap.css\" onload=\"document.documentElement.style.display = ''\">"
    );
  }
</script><title>Does it work? (CPMs) • bayesDCA</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Does it work? (CPMs)">
<meta property="og:description" content="Simulation-based evaluation of {bayesDCA} for Clinical Prediction Models (CPMs).
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Flatly Theme - Light  --><link id="css-light" rel="stylesheet" href="https://bootswatch.com/5/flatly/bootstrap.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<!-- Darkly Theme - Dark --><link id="css-dark" rel="stylesheet" href="https://bootswatch.com/5/darkly/bootstrap.css" media="(prefers-color-scheme: dark)">
<!-- preferably CSS --><link rel="stylesheet" href="../preferably.css">
<link id="css-code-light" rel="stylesheet" href="../code-color-scheme-light.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<link id="css-code-dark" rel="stylesheet" href="../code-color-scheme-dark.css" media="(prefers-color-scheme: dark)">
<script src="../darkswitch.js"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">bayesDCA</a>

    <small class="nav-text text-info me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-does-it-work-">Does it work?</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-does-it-work-">
    <a class="dropdown-item" href="../articles/performance-cpm.html">Clincal Prediction Models</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/giulianonetto/bayesdca/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>

        
        <li>
          <a class="external-link nav-link" id="css-toggle-btn" aria-label="github">
            <span class="fas fa fas fa-adjust fa-lg"></span>
          </a>
        </li>
        
        
        
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">

<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Does it work? (CPMs)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/giulianonetto/bayesdca/vignettes/performance-cpm.Rmd" class="external-link"><code>vignettes/performance-cpm.Rmd</code></a></small>
      <div class="d-none name"><code>performance-cpm.Rmd</code></div>
    </div>

    
    
<p>As a simple demonstration, let’s simulate ground truth data from a “super-population” of 2M patients, each with a pre-determined probability of disease. We’ll use samples from this population to estimate the decision curves using <code>bayesDCA</code>, and then check for bias in the estimation and empirical coverage of the uncertainty intervals.</p>
<div class="section level2">
<h2 id="simulate-super-population">Simulate super-population<a class="anchor" aria-label="anchor" href="#simulate-super-population"></a>
</h2>
<p>Let’s simulate a population in which the probability of disease is determined by a linear combination of two independent normal random variables (plus an intercept).</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">N_pop</span> <span class="op">&lt;-</span> <span class="fl">1e6</span>
<span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>
  <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N_pop</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N_pop</span><span class="op">)</span>
<span class="op">)</span>
<span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2.5</span>, <span class="fl">3</span>, <span class="op">-</span><span class="fl">3</span><span class="op">)</span>
<span class="va">prob_disease</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span>
  <span class="va">prob_disease</span>,
  main <span class="op">=</span> <span class="st">"Distribution of the true probabilities of disease\nin the super-population"</span>
<span class="op">)</span></code></pre></div>
<p><img src="performance-cpm_files/figure-html/unnamed-chunk-2-1.png" width="2100"></p>
<p>In practice these probabilities are not observable, so we must simulate the actual binary outcomes as well. A logistic regression models recovers the parameters perfectly given our huge sample size and simple setting.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>
  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">N_pop</span>, <span class="fl">1</span>, <span class="va">prob_disease</span><span class="op">)</span>, 
  <span class="va">X</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>
<span class="op">)</span>
<span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">X1</span> <span class="op">+</span> <span class="va">X2</span>, data <span class="op">=</span> <span class="va">df_pop</span>, family <span class="op">=</span> <span class="st">'binomial'</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:  glm(formula = y ~ X1 + X2, family = "binomial", data = df_pop)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt; (Intercept)           X1           X2  </span>
<span class="co">#&gt;      -2.510        3.003       -3.006  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Degrees of Freedom: 999999 Total (i.e. Null);  999997 Residual</span>
<span class="co">#&gt; Null Deviance:       1210000 </span>
<span class="co">#&gt; Residual Deviance: 480500    AIC: 480500</span></code></pre></div>
<p>As expected, the predicted probabilities match the true probabilities of disease.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">predicted_prob_disease</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, type <span class="op">=</span> <span class="st">'response'</span><span class="op">)</span>
<span class="va">ix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">N_pop</span>, <span class="fl">1e3</span><span class="op">)</span> <span class="co"># select patients to plot fast</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>
  <span class="va">predicted_prob_disease</span><span class="op">[</span><span class="va">ix</span><span class="op">]</span>,
  <span class="va">prob_disease</span><span class="op">[</span><span class="va">ix</span><span class="op">]</span>,
  xlab <span class="op">=</span> <span class="st">"Predicted probabilties"</span>,
  ylab <span class="op">=</span> <span class="st">"True probabilities"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, col <span class="op">=</span> <span class="st">'red'</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="performance-cpm_files/figure-html/unnamed-chunk-4-1.png" width="2100"></p>
<p>Let’s use these accurate predictions to make a reference decision curve, which we will use as ground truth. In order to do that, we’ll use the <code>bayesDCA:::get_thr_data</code> function, which <code>bayesDCA</code> uses under the hood to compute true positive/negative calls for each probability threshold, given a series of outcomes and predictions.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dca_pop_data</span> <span class="op">&lt;-</span> <span class="fu">bayesDCA</span><span class="fu">:::</span><span class="fu"><a href="../reference/get_thr_data.html">get_thr_data</a></span><span class="op">(</span>
  outcomes <span class="op">=</span> <span class="va">df_pop</span><span class="op">$</span><span class="va">y</span>,
  predictions <span class="op">=</span> <span class="va">predicted_prob_disease</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dca_pop_data</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 5</span></span>
<span class="co">#&gt;         N      d     tp     tn thresholds</span>
<span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1<span style="text-decoration: underline;">000</span>000 <span style="text-decoration: underline;">293</span>370 <span style="text-decoration: underline;">293</span>370      0       0   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1<span style="text-decoration: underline;">000</span>000 <span style="text-decoration: underline;">293</span>370 <span style="text-decoration: underline;">291</span>800 <span style="text-decoration: underline;">371</span>070       0.02</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1<span style="text-decoration: underline;">000</span>000 <span style="text-decoration: underline;">293</span>370 <span style="text-decoration: underline;">289</span>854 <span style="text-decoration: underline;">433</span>944       0.04</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1<span style="text-decoration: underline;">000</span>000 <span style="text-decoration: underline;">293</span>370 <span style="text-decoration: underline;">287</span>842 <span style="text-decoration: underline;">471</span>619       0.06</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1<span style="text-decoration: underline;">000</span>000 <span style="text-decoration: underline;">293</span>370 <span style="text-decoration: underline;">285</span>794 <span style="text-decoration: underline;">498</span>908       0.08</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1<span style="text-decoration: underline;">000</span>000 <span style="text-decoration: underline;">293</span>370 <span style="text-decoration: underline;">283</span>763 <span style="text-decoration: underline;">519</span>812       0.1</span></code></pre></div>
<p>With these we are ready to plot our reference decision curve. Recall that DCA plots Net Benefit (NB) against probability thresholds. The NB is defined as:</p>
<p><span class="math display">\[
NB_t = p \cdot Se_t - (1 - p)\cdot (1-Sp_t) \cdot \frac{t}{1-t} 
\]</span></p>
<p>where <span class="math inline">\(p\)</span> is prevalence or outcome proportion, <span class="math inline">\(Se_t\)</span> is sensitivity at threshold <span class="math inline">\(t\)</span> and <span class="math inline">\(Sp_t\)</span> is the specificity at threshold <span class="math inline">\(t\)</span>.</p>
<p>We first compute <span class="math inline">\(p\)</span> (same for all <span class="math inline">\(t\)</span>), <span class="math inline">\(Se_t\)</span>, and <span class="math inline">\(Sp_t\)</span>, and then the actual <span class="math inline">\(NB_t\)</span>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>
<span class="co">#&gt; ── <span style="font-weight: bold;">Attaching packages</span> ─────────────────────────────────────── tidyverse 1.3.1 ──</span>
<span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #0000BB;">ggplot2</span> 3.3.5     <span style="color: #00BB00;">✓</span> <span style="color: #0000BB;">purrr  </span> 0.3.4</span>
<span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #0000BB;">tibble </span> 3.1.6     <span style="color: #00BB00;">✓</span> <span style="color: #0000BB;">dplyr  </span> 1.0.7</span>
<span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #0000BB;">tidyr  </span> 1.1.4     <span style="color: #00BB00;">✓</span> <span style="color: #0000BB;">stringr</span> 1.4.0</span>
<span class="co">#&gt; <span style="color: #00BB00;">✓</span> <span style="color: #0000BB;">readr  </span> 2.1.1     <span style="color: #00BB00;">✓</span> <span style="color: #0000BB;">forcats</span> 0.5.1</span>
<span class="co">#&gt; ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span>
<span class="co">#&gt; <span style="color: #BB0000;">x</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span>
<span class="co">#&gt; <span style="color: #BB0000;">x</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span>
<span class="va">dca_pop_data</span> <span class="op">&lt;-</span> <span class="va">dca_pop_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    p <span class="op">=</span> <span class="va">d</span><span class="op">/</span><span class="va">N</span>,
    Se <span class="op">=</span> <span class="va">tp</span><span class="op">/</span><span class="va">d</span>,
    Sp <span class="op">=</span> <span class="va">tn</span><span class="op">/</span><span class="op">(</span><span class="va">N</span><span class="op">-</span><span class="va">d</span><span class="op">)</span>,
    NB <span class="op">=</span> <span class="va">Se</span><span class="op">*</span><span class="va">p</span> <span class="op">-</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">p</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">Sp</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">thresholds</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">thresholds</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">dca_pop_data</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 9</span></span>
<span class="co">#&gt;         N      d     tp     tn thresholds     p    Se    Sp    NB</span>
<span class="co">#&gt;     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1<span style="text-decoration: underline;">000</span>000 <span style="text-decoration: underline;">293</span>370 <span style="text-decoration: underline;">293</span>370      0       0    0.293 1     0     0.293</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1<span style="text-decoration: underline;">000</span>000 <span style="text-decoration: underline;">293</span>370 <span style="text-decoration: underline;">291</span>800 <span style="text-decoration: underline;">371</span>070       0.02 0.293 0.995 0.525 0.285</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1<span style="text-decoration: underline;">000</span>000 <span style="text-decoration: underline;">293</span>370 <span style="text-decoration: underline;">289</span>854 <span style="text-decoration: underline;">433</span>944       0.04 0.293 0.988 0.614 0.278</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1<span style="text-decoration: underline;">000</span>000 <span style="text-decoration: underline;">293</span>370 <span style="text-decoration: underline;">287</span>842 <span style="text-decoration: underline;">471</span>619       0.06 0.293 0.981 0.667 0.273</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1<span style="text-decoration: underline;">000</span>000 <span style="text-decoration: underline;">293</span>370 <span style="text-decoration: underline;">285</span>794 <span style="text-decoration: underline;">498</span>908       0.08 0.293 0.974 0.706 0.268</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1<span style="text-decoration: underline;">000</span>000 <span style="text-decoration: underline;">293</span>370 <span style="text-decoration: underline;">283</span>763 <span style="text-decoration: underline;">519</span>812       0.1  0.293 0.967 0.736 0.263</span></code></pre></div>
<p>We can plot the reference decision curve:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dca_pop_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">thresholds</span>, <span class="va">NB</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Probability threshold"</span>,
       y <span class="op">=</span> <span class="st">"Net Benefit"</span>,
       title <span class="op">=</span> <span class="st">"Reference decision curve for perfect model"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="performance-cpm_files/figure-html/unnamed-chunk-7-1.png" width="2100"></p>
</div>
<div class="section level2">
<h2 id="simulating-validation-studies">Simulating validation studies<a class="anchor" aria-label="anchor" href="#simulating-validation-studies"></a>
</h2>
<p>In a validation study, we use DCA to assess the performance of a previously-estimated model in a sample of the population. Given our (nearly perfect) model, we can study the variability in the decision curve estimates by computing them for many subsamples of our super-population. Let’s simulate <code>B=500</code> validation studies for our model. In each validation study, we will use samples of size <code>N=400</code> to get 120 expected events. The variable <code>subsamples_ix</code> below is a list of length <span class="math inline">\(B\)</span> whose items are subsample indexes for our super-population - each of length <span class="math inline">\(N\)</span>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">B</span> <span class="op">&lt;-</span> <span class="fl">500</span>
<span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">400</span>
<span class="va">samples_ix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">B</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">N_pop</span>, <span class="va">N</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We then simulate the validation studies, following the same steps to compute a decision curve for each. We keep only the thresholds and NB information for further analysis.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">validations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">'list'</span>, <span class="va">B</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">B</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">sample_ix</span> <span class="op">&lt;-</span> <span class="va">samples_ix</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>
  <span class="va">df_sample</span> <span class="op">&lt;-</span> <span class="va">df_pop</span><span class="op">[</span><span class="va">sample_ix</span>, <span class="op">]</span>
  <span class="va">pred_prob_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, 
                              newdata <span class="op">=</span> <span class="va">df_sample</span>, 
                              type <span class="op">=</span> <span class="st">'response'</span><span class="op">)</span>
  <span class="va">dca_sample_data</span> <span class="op">&lt;-</span> <span class="fu">bayesDCA</span><span class="fu">:::</span><span class="fu"><a href="../reference/get_thr_data.html">get_thr_data</a></span><span class="op">(</span><span class="va">df_sample</span><span class="op">$</span><span class="va">y</span>,
                                             <span class="va">pred_prob_sample</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
      p <span class="op">=</span> <span class="va">d</span><span class="op">/</span><span class="va">N</span>,
      Se <span class="op">=</span> <span class="va">tp</span><span class="op">/</span><span class="va">d</span>,
      Sp <span class="op">=</span> <span class="va">tn</span><span class="op">/</span><span class="op">(</span><span class="va">N</span><span class="op">-</span><span class="va">d</span><span class="op">)</span>,
      NB <span class="op">=</span> <span class="va">Se</span><span class="op">*</span><span class="va">p</span> <span class="op">-</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">p</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">Sp</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">thresholds</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">thresholds</span><span class="op">)</span><span class="op">)</span>
    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">thresholds</span>, <span class="va">NB</span><span class="op">)</span>
  <span class="va">validations</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">dca_sample_data</span>
<span class="op">}</span>
<span class="co"># collect simulated studies into data.frame</span>
<span class="va">validations</span> <span class="op">&lt;-</span> <span class="va">validations</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"study_id"</span><span class="op">)</span></code></pre></div>
<p>Let’s now plot the simulations against the reference decision curve. In gray, we plot the curves from each sample; in red, the reference curve.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">validations</span>,
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">thresholds</span>, <span class="va">NB</span>, group <span class="op">=</span> <span class="va">study_id</span><span class="op">)</span>,
    color <span class="op">=</span> <span class="st">"gray40"</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">dca_pop_data</span>,
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">thresholds</span>, <span class="va">NB</span><span class="op">)</span>,
    color <span class="op">=</span> <span class="st">"red"</span>, lwd <span class="op">=</span> <span class="fl">1.2</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Probability threshold"</span>,
       y <span class="op">=</span> <span class="st">"Net Benefit"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="performance-cpm_files/figure-html/unnamed-chunk-10-1.png" width="2100"></p>
<p>Even though on average this procedure seems to do fine, it is clear that there’s some non-negligible uncertainty in the decision curve estimation process. For studies lying on the top of the plot, perhaps you will feel overconfident about your model; for studies in the bottom of the lines distribution, you might end up discarding an actually useful model. The <code>bayesDCA</code> R package deals with that by estimating uncertainty intervals around each estimated curve, for each individual validation study.</p>
<p>Let’s now repeat the simulation above, but using <code>bayesDCA</code> to estimate the decision curves. We will check for bias in the curve estimates as well as for pointwise coverage of the uncertainty intervals.</p>
</div>
<div class="section level2">
<h2 id="validating-with-bayesdca">Validating with <code>bayesDCA</code><a class="anchor" aria-label="anchor" href="#validating-with-bayesdca"></a>
</h2>
<p>We follow the same steps as before, but use <code>bayesDCA</code> for all computations. The <code>select</code> statement below converts <code>bayesDCA</code> output into the notation we have been using so far.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">bayesDCA</span><span class="op">)</span>
<span class="va">validations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">'list'</span>, <span class="va">B</span><span class="op">)</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">B</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">sample_ix</span> <span class="op">&lt;-</span> <span class="va">samples_ix</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>
  <span class="va">df_sample</span> <span class="op">&lt;-</span> <span class="va">df_pop</span><span class="op">[</span><span class="va">sample_ix</span>, <span class="op">]</span>
  <span class="va">pred_prob_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, 
                              newdata <span class="op">=</span> <span class="va">df_sample</span>, 
                              type <span class="op">=</span> <span class="st">'response'</span><span class="op">)</span>
  <span class="va">dca_fit_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dca_predictive_model.html">dca_predictive_model</a></span><span class="op">(</span><span class="va">df_sample</span><span class="op">$</span><span class="va">y</span>,
                                         <span class="va">pred_prob_sample</span><span class="op">)</span>
  <span class="va">dca_sample_data</span> <span class="op">&lt;-</span> <span class="va">dca_fit_sample</span><span class="op">$</span><span class="va">net_benefit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">thresholds</span> <span class="op">:=</span> <span class="va">thr</span>, 
           <span class="va">NB</span> <span class="op">:=</span> <span class="va">estimate</span>,
           <span class="va">lower</span> <span class="op">:=</span> <span class="va">`2.5%`</span>,
           <span class="va">upper</span> <span class="op">:=</span> <span class="va">`97.5%`</span><span class="op">)</span>
  <span class="va">validations</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">dca_sample_data</span>
<span class="op">}</span>
<span class="co"># collect simulated studies into data.frame</span>
<span class="va">validations</span> <span class="op">&lt;-</span> <span class="va">validations</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span>.id <span class="op">=</span> <span class="st">"study_id"</span><span class="op">)</span></code></pre></div>
<p>Let’s plot a single decision curve from <code>bayesDCA</code> just to visualize the primary uncertainty intervals:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dca_fit_sample</span>, .color <span class="op">=</span> <span class="st">'blue'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">dca_pop_data</span>,
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">thresholds</span>, <span class="va">NB</span><span class="op">)</span>,
    color <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>
  <span class="op">)</span></code></pre></div>
<p><img src="performance-cpm_files/figure-html/unnamed-chunk-12-1.png" width="2100"></p>
<p>The interval properly captures the reference curve. Notice that the maximum estimated NB does not exactly match the maximum reference NB. This is because our sample has observed prevalence of 0.2875, while the super-population has a true prevalence of 0.29337.</p>
<p>We then plot the point estimates for each curve along with the reference decision curve, plus the pointwise average of the estimated (dashed blue):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">validations</span>,
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">thresholds</span>, <span class="va">NB</span>, group <span class="op">=</span> <span class="va">study_id</span><span class="op">)</span>,
    color <span class="op">=</span> <span class="st">"gray40"</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">dca_pop_data</span>,
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">thresholds</span>, <span class="va">NB</span><span class="op">)</span>,
    color <span class="op">=</span> <span class="st">"red"</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>
    data <span class="op">=</span> <span class="va">validations</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">thresholds</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>NB <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">NB</span><span class="op">)</span><span class="op">)</span>,
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">thresholds</span>, <span class="va">NB</span><span class="op">)</span>,
    color <span class="op">=</span> <span class="st">"blue"</span>, linetype <span class="op">=</span> <span class="st">'dashed'</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Probability threshold"</span>,
       y <span class="op">=</span> <span class="st">"Net Benefit"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="performance-cpm_files/figure-html/unnamed-chunk-13-1.png" width="2100"></p>
<p>We see the same variability in the (unbiased) point estimates. But how did the uncertainty intervals do? Let’s compute the pointwise empirical coverage of the 95% credible intervals computed by default in <code>bayesDCA</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_coverage</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span>
  <span class="va">validations</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">study_id</span>, <span class="va">thresholds</span>, <span class="va">lower</span>, <span class="va">upper</span><span class="op">)</span>,
  <span class="va">dca_pop_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="va">true_NB</span> <span class="op">:=</span> <span class="va">NB</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">thresholds</span>, <span class="va">true_NB</span><span class="op">)</span>,
  by <span class="op">=</span> <span class="st">"thresholds"</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df_coverage</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 5</span></span>
<span class="co">#&gt;   study_id thresholds lower upper true_NB</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1              0    0.267 0.358   0.293</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1              0.02 0.256 0.348   0.285</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 1              0.04 0.248 0.341   0.278</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 1              0.06 0.243 0.336   0.273</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 1              0.08 0.236 0.329   0.268</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 1              0.1  0.233 0.327   0.263</span></code></pre></div>
<p>Group by threshold, summarize over study ids, and plot results:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df_coverage</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">thresholds</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>
    coverage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span>
      <span class="va">true_NB</span> <span class="op">&gt;=</span> <span class="va">lower</span> <span class="op">&amp;</span> <span class="va">true_NB</span> <span class="op">&lt;=</span> <span class="va">upper</span>
    <span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>
    <span class="va">thresholds</span>,
    <span class="va">coverage</span>
  <span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>lwd <span class="op">=</span> <span class="fl">1.2</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/label_percent.html" class="external-link">percent</a></span>,
                     limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1.01</span><span class="op">)</span>,
                     breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_pretty.html" class="external-link">pretty_breaks</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="performance-cpm_files/figure-html/unnamed-chunk-15-1.png" width="2100"></p>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>Decision Curve Analysis of predictive models in validation studies benefits from uncertainty quantification, as point estimates suffer from sampling variability. The R package <code>bayesDCA</code> accurately estimates decisions curves and provides reliable uncertainty intervals around such estimates.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://giulianonetto.netlify.app" class="external-link">Giuliano Netto Flores Cruz</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
  <p class="preferably">Using <a href="https://preferably.amirmasoudabdol.name/?source=footer" class="external-link">preferably</a> template.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
