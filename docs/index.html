<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Performs Bayesian Decision Curve Analysis (DCA) for diagnostic tests and clinical prediction models.">
<!-- Inform modern browsers that this page supports both dark and light color schemes,
  and the page author prefers light. --><meta name="color-scheme" content="dark light">
<script>
  // If `prefers-color-scheme` is not supported, fall back to light mode.
  // i.e. In this case, inject the `light` CSS before the others, with
  // no media filter so that it will be downloaded with highest priority.
  if (window.matchMedia("(prefers-color-scheme: dark)").media === "not all") {
    document.documentElement.style.display = "none";
    document.head.insertAdjacentHTML(
      "beforeend",
      "<link id=\"css\" rel=\"stylesheet\" href=\"https://bootswatch.com/5/flatly/bootstrap.css\" onload=\"document.documentElement.style.display = ''\">"
    );
  }
</script><title>Bayesian Decision Curve Analysis • bayesDCA</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Bayesian Decision Curve Analysis">
<meta property="og:description" content="Performs Bayesian Decision Curve Analysis (DCA) for diagnostic tests and clinical prediction models.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Flatly Theme - Light  --><link id="css-light" rel="stylesheet" href="https://bootswatch.com/5/flatly/bootstrap.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<!-- Darkly Theme - Dark --><link id="css-dark" rel="stylesheet" href="https://bootswatch.com/5/darkly/bootstrap.css" media="(prefers-color-scheme: dark)">
<!-- preferably CSS --><link rel="stylesheet" href="preferably.css">
<link id="css-code-light" rel="stylesheet" href="code-color-scheme-light.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<link id="css-code-dark" rel="stylesheet" href="code-color-scheme-dark.css" media="(prefers-color-scheme: dark)">
<script src="darkswitch.js"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">bayesDCA</a>

    <small class="nav-text text-info me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-does-it-work-">Does it work?</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-does-it-work-">
    <a class="dropdown-item" href="articles/performance-cpm.html">Clincal Prediction Models</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/giulianonetto/bayesdca/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>

        
        <li>
          <a class="external-link nav-link" id="css-toggle-btn" aria-label="github">
            <span class="fas fa fas fa-adjust fa-lg"></span>
          </a>
        </li>
        
        
        
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="bayesdca">bayesDCA<a class="anchor" aria-label="anchor" href="#bayesdca"></a>
</h1></div>
<!-- badges: start -->

<p>Perform Bayesian Decision Curve Analysis for clinical prediction models and diagnostic tests.</p>
<p>When validating a clinical prediction model, you may end up with AUC 0.79 and a slight miscalibration. How do you know if that is good enough for your model to be clinically useful? The same question can be asked if you have a diagnostic test with sensitivity of 75% and specificity of 68%. Decision Curve Analysis helps us find an answer - see <a href="https://diagnprognres.biomedcentral.com/articles/10.1186/s41512-019-0064-7" class="external-link">Vickers, van Calster &amp; Steyerberg, 2019</a> for an introduction to DCA. Here, we use Bayesian methods to accurately quantify uncertainty in our decisions curves - powered by <a href="https://mc-stan.org/" class="external-link">Stan</a>.</p>
</div>
<div class="section level1">
<h1 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h1>
<p>You can install the development version of bayesDCA from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("devtools")</span>
<span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/remote-reexports.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"giulianonetto/bayesdca"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level1">
<h1 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h1>
<p>You can use <code>bayesDCA</code> to evaluate predictive models as well as binary and continuous tests - either diagnostic or prognostic. All plots are either <a href="https://ggplot2.tidyverse.org/" class="external-link"><code>ggplot2</code></a> or <a href="https://patchwork.data-imaginist.com/" class="external-link"><code>patchwork</code></a> objects. All plotting functions have a <code>data_only</code> argument with which one can access raw plotting data.</p>
<div class="section level2">
<h2 id="clinical-prediction-model">Clinical prediction model<a class="anchor" aria-label="anchor" href="#clinical-prediction-model"></a>
</h2>
<p>For your clinical prediction model (CPM), you only need the patients’ <code>outcomes</code> (0 or 1) and the corresponding <code>predictions</code> (predicted probabilities).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">bayesDCA</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">PredModelData</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">PredModelData</span><span class="op">)</span>
<span class="co">#&gt;   outcomes predictions</span>
<span class="co">#&gt; 1        0  0.01280653</span>
<span class="co">#&gt; 2        0  0.13981948</span>
<span class="co">#&gt; 3        0  0.03566458</span>
<span class="co">#&gt; 4        0  0.02351731</span>
<span class="co">#&gt; 5        0  0.00863298</span>
<span class="co">#&gt; 6        0  0.00959754</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/dca_predictive_model.html">dca_predictive_model</a></span><span class="op">(</span>outcomes <span class="op">=</span> <span class="va">PredModelData</span><span class="op">$</span><span class="va">outcomes</span>,
                            predictions <span class="op">=</span> <span class="va">PredModelData</span><span class="op">$</span><span class="va">predictions</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-4-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="binary-test">Binary test<a class="anchor" aria-label="anchor" href="#binary-test"></a>
</h2>
<p>If you have a binary test, either diagnostic or prognostic, you just need to specify the sample size (<code>N</code>), the number of diseased patients or events (<code>d</code>), the number of true positives (<code>tp</code>), and the number of true negatives (<code>tn</code>).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">bayesDCA</span><span class="op">)</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/dca_binary_test.html">dca_binary_test</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fl">500</span>, d <span class="op">=</span> <span class="fl">83</span>, tp <span class="op">=</span> <span class="fl">77</span>, tn <span class="op">=</span> <span class="fl">378</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-5-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="plotting-multiple-tests-andor-models">Plotting multiple tests and/or models<a class="anchor" aria-label="anchor" href="#plotting-multiple-tests-andor-models"></a>
</h2>
<p>You can use <code>plot_dca_list</code> to visualize multiple tests or models simultaneously.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">bayesDCA</span><span class="op">)</span>
<span class="co"># binary tests</span>
<span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/dca_binary_test.html">dca_binary_test</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fl">1000</span>, d <span class="op">=</span> <span class="fl">120</span>, tp <span class="op">=</span> <span class="fl">80</span>, tn <span class="op">=</span> <span class="fl">800</span><span class="op">)</span>
<span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/dca_binary_test.html">dca_binary_test</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fl">1000</span>, d <span class="op">=</span> <span class="fl">120</span>, tp <span class="op">=</span> <span class="fl">108</span>, tn <span class="op">=</span> <span class="fl">616</span><span class="op">)</span>
<span class="co"># predictive model</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">PredModelData</span><span class="op">)</span>
<span class="va">fit3</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/dca_predictive_model.html">dca_predictive_model</a></span><span class="op">(</span>outcomes <span class="op">=</span> <span class="va">PredModelData</span><span class="op">$</span><span class="va">outcomes</span>,
                             predictions <span class="op">=</span> <span class="va">PredModelData</span><span class="op">$</span><span class="va">predictions</span><span class="op">)</span>
<span class="co"># plot decision curves</span>
<span class="fu"><a href="reference/plot_dca_list.html">plot_dca_list</a></span><span class="op">(</span><span class="st">"test A"</span> <span class="op">=</span> <span class="va">fit1</span>, <span class="st">"test B"</span> <span class="op">=</span> <span class="va">fit2</span>, <span class="st">"model"</span> <span class="op">=</span> <span class="va">fit3</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-6-1.png" width="100%"></p>
<p>In this example, the predictive model doesn’t seem to add much over the diagnostic tests for most thresholds, although it might overcome the tests for very high thresholds (e.g. aove 40%). If the model requires multiple predictors, then one migh prefer to use simple binary tests - depending on the application, of course. In that case, one may wonder which test to pick.</p>
</div>
<div class="section level2">
<h2 id="compare-dca">Compare DCA<a class="anchor" aria-label="anchor" href="#compare-dca"></a>
</h2>
<p>If you want to compare the decision curves from two models and/or tests, you can provide the <code>fit</code> objects to the <code>compare_dca</code> function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">bayesDCA</span><span class="op">)</span>

<span class="co"># Test A: Se = 66%, Sp = 91%</span>
<span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/dca_binary_test.html">dca_binary_test</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fl">1000</span>, d <span class="op">=</span> <span class="fl">120</span>, tp <span class="op">=</span> <span class="fl">80</span>, tn <span class="op">=</span> <span class="fl">800</span><span class="op">)</span>

<span class="co"># Test B: Se = 90%, Sp = 70%</span>
<span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/dca_binary_test.html">dca_binary_test</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fl">1000</span>, d <span class="op">=</span> <span class="fl">120</span>, tp <span class="op">=</span> <span class="fl">108</span>, tn <span class="op">=</span> <span class="fl">616</span><span class="op">)</span>
<span class="fu"><a href="reference/compare_dca.html">compare_dca</a></span><span class="op">(</span><span class="st">"Test A"</span> <span class="op">=</span> <span class="va">fit1</span>, <span class="st">"Test B"</span> <span class="op">=</span> <span class="va">fit2</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-7-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="continuous-tests-scores-gene-signatures-etc">Continuous tests, scores, gene signatures, etc.<a class="anchor" aria-label="anchor" href="#continuous-tests-scores-gene-signatures-etc"></a>
</h2>
<p><a href="https://www.prognosisresearch.com/videos-categorisation" class="external-link">Categorization of continuous predictors is strongly discouraged</a>, and continuous tests are no different. This also applies to prognostic or diagnostic scores, expression signatures, and all of the like. As decisions are often categorical, it’s better to categorize outcome probabilities and then map probability thresholds back to corresponding test values. You end up with a test cutoff either way, but only one is clinically motivated - see <a href="https://bmcmedicine.biomedcentral.com/articles/10.1186/s12916-019-1425-3#Sec3" class="external-link">Myth 2</a> in <a href="https://bmcmedicine.biomedcentral.com/articles/10.1186/s12916-019-1425-3" class="external-link">Wynants et al, 2019</a>. This risk stratification procedure can be applied seamlessly by fitting single-predictor models (e.g. <code>Disease ~ test_value</code>). This leads to clinically-informed test cutoffs as opposed to observed-data arbitrariness (e.g. categorizing by quantile of the score, which yields arbitrary risk distributions in the score strata).</p>
<p>Notice that choosing an appropriate risk threshold for your continuous test properly balances your requirements for sensitivity and specificity according to the clinical context - the cost of each correct or incorrect decision. Whereas one may wish to maximize sensitivity and specificity simultaneously (e.g. pick the “elbow” in a ROC curve), that procedure effectively assumes that false positives have the same costs as false negatives, which is usually dramatically incorrect. For instance, a screening test surely should penalize false negatives way more heavily than false positives, while for a confirmatory test the cost of false positives would be more important. Hence, the resulting test cutoff should be optimized by clinical reasoning, not by data-driven artifacts.</p>
<p>Once you have your test cutoff, you can compute <code>tp</code> and <code>tn</code> and proceed with <code>dca_binary_test</code> as usual. Of course, a likely better approach would be to use your model to take advantage of the (non-linear) relationship between test values and outcome probability, but that turns your diagnostic/prognostic test study into a predictive model study - you would use <code>dca_predictive_model</code> in that case.</p>
<p>Future versions of <code>bayesDCA</code> should include an easy API for this task.</p>
</div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/giulianonetto/bayesdca/" class="external-link">Browse source code</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing bayesDCA</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://giulianonetto.netlify.app" class="external-link">Giuliano Netto Flores Cruz</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0001-9122-8286" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://lifecycle.r-lib.org/articles/stages.html#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://giulianonetto.netlify.app" class="external-link">Giuliano Netto Flores Cruz</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
  <p class="preferably">Using <a href="https://preferably.amirmasoudabdol.name/?source=footer" class="external-link">preferably</a> template.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
